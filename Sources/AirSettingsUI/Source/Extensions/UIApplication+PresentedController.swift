//
//  UIApplication+PresentedController.swift
//  AirSettingUI
//
//  Created by iOS Developer on 2023-09-28.
//  Copyright Â© 2023 AirApps. All rights reserved.
//

import SwiftUI

@available(iOS 15.0, *)
extension UIApplication {
    
    var keyWindow: UIWindow? {
        self.connectedScenes
            .first(where: { $0 is UIWindowScene && $0.activationState == .foregroundActive })
            .flatMap({ $0 as? UIWindowScene })?.windows
            .first(where: \.isKeyWindow)
    }
    
    var keyWindowPresentedController: UIViewController? {
        var viewController = self.keyWindow?.rootViewController
        
        if let presentedController = viewController as? UITabBarController {
            viewController = presentedController.selectedViewController
        }
        
        while let presentedController = viewController?.presentedViewController {
            if let presentedController = presentedController as? UITabBarController {
                viewController = presentedController.selectedViewController
            } else {
                viewController = presentedController
            }
        }
        
        return viewController
    }
}
